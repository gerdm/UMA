\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{tikz}
\usetikzlibrary{arrows,shapes,positioning}

\title{Notes on Pricing Derivatives}
\author{Gerardo Durán Martín}

\newtheorem{theorem}{Theorem}[section]

\begin{document}
\maketitle


\section{Introduction}
Broadly speaking, financial instruments can be grouped into two distinct categories: \textit{underlying}s and \textit{derivatives}. The former referfs to stocks, bonds, commodities, foreign exchange currencies, etc; while the latter refers to financial contracts with a promise to pay in the future, whose value is \textit{derived} from some underlying asset. This last point imples, that the aformentioned future payment is contingent to the future value of the underlying, whichever this might be.\\

A financial institution might be interested in selling these derivatives as a service and charge a fee for it. The question then arises, how much should the financial institution charge for these products? As a first attempt to \texit{price} any of these derivatives, one could to charge the expected value of the derivative in the future, discounted at some rate $r$. Simply put, assuming we can sell many units of a given product, by \textbf{Kolmogorov's Strong Law of Large Numbers}, we would expect, in the long run, to break even:

\begin{theorem}
    Let $\{X_n\}_{n\geq 1}$ be a collection of i.i.d. random variables with mean $\mu$. Denote $S_n = \frac{1}{n}\sum_{i=1}^n X_n$. Then, with probability one,
    \begin{equation}
        S_n \xrightarrow[n \rightarrow \infty]{}\mu
    \end{equation}
\end{theorem}


%%% TODO: write about the failure of this approach by pricing a forward that could lead to arbitrage and a loss for the financial institution
Feasible as it may seem, this firt approach to pricing a derivative could lead to disaster for the financial institution.



\section{One-Step Binomial Models}
In order to generalize an arbitrage-free approach to price any derivative, we would like to construct a model that truly reflects the market (unlike the LLN approach). In its simples form, this market should consist of a cash bond and a stock. We will asume, that the market moves in discrete units of time.\\

\textbf{The Stock}\\
Between any two units of time (e.g. from $t=0$ to $t=1$), the stock can either go up with probability $p$, or down with probability $1-p$; it will have an initial value $S_0$ and, with any these movements, the stock is multiplied by an up factor $u$, or a down factor $d$, depending on where it moves to. Evidently, $0 < d < 1 < u$. Finally, we will assume that unlimited amounts of the stock can be bought at any time and there is no cost incurred.

\begin{center}
\begin{tikzpicture}
    \draw[->] (0,0) node[left]{$S_0$} --(2, 0.5) node[pos=0.5, sloped, above] {$p$};
    \node[text, right] at (2, 0.5) {$S_0u$};

    \draw[->] (0,0) --(2, -0.5) node[pos=0.5, sloped, below] {$1-p$};
    \node[text, right] at (2, -0.5) {$S_0d$}
\end{tikzpicture}
\end{center}

\textbf{The Bond}\\
The bank account represents the time value of money. We will assume a constant, risk-free, countinously compounding interest rate $r$. For $\$B_0$ invested at $t=0$, said rate guarantees, at the end of $T$ periods, $B_0 e^{rT}$. Also, we will assume that we can lend or borrow at the same interest rate $r$.\\

\textbf{The Derivative}\\
This model carries within the possibility of a market that depends on the price of the stock. That is, there could be a payoff $f$ with price $f_0$ that derives its future value from the direction the stock took. Either $f_u$ if it went up, or $f_d$ if it went down.

\subsection{Pricing}
We can now ask whether we can construct a portfolio such that replicates $f$ from a suitable strategy, thus paying the promised amount. What we are looking for is to guarantee the value of the derivative at the moment of settlement, thus hedging the risk away.\\

Consider the portfolio $(\phi, \psi)$, where $\phi$ denotes the number of shares for stock $S$ in the portfolio and $\psi$ denotes the amount in the bank. At $t=0$, this portfolio is worth

\begin{equation*}
    \phi S_0 + \psi B_0
\end{equation*}

At $t=\delta t$, this portfolio will be worth one of two possible values:

\begin{align*}
    \phi S_0u + \psi B_0e^{r \delta t}\\
    \phi S_0d + \psi B_0e^{r \delta t}
\end{align*}

With this in mind, we now turn to answer our question. In order to hedge the risk, we would like to find values for $(\phi, \psi)$ in order to replicate the payoff:

\begin{align*}
    \phi S_0u + \psi B_0e^{r \delta t} = f_u\\
    \phi S_0d + \psi B_0e^{r \delta t} = f_d
\end{align*}

We can now solve for $\phi$ and $\psi$:

\begin{align*}
    \phi S_0(u - d) &= f_u - f_d\\
                    &= \frac{f_u - f_d}{S_0(u-d)}
\end{align*}

\begin{align*}
    \psi &= e^{-r\delta t} [f_u - \phi u]\\
         &= e^{-r\delta t} \left[f_u - \frac{f_u - f_d}{S_0(u - d)} S_0u\right]\\
         &= e^{-r\delta t} \frac{uf_d - df_u}{u -d}
\end{align*}

Thus, buying the portfolio $(\phi, \psi)$ guaranteed the payoff at $t=\delta_t$. Denote $\mathcal{V}$ the value of the portfolio at $t=0$. The value of $\mathcal{V}$ is:

\begin{align*}
    \mathcal{V} &= \phi S_0 + \psi\\
                &= \left[\frac{f_u - f_d}{S_0(u - d)}S_0\right] + \left[e^{-r\delta_t}\right]\\
                &= e^{-r\delta_t}\left[\frac{e^{r\delta_t}(f_u - f_d + uf_d - df_u)}{u - d}\right]\\
                &= e^{-r\delta_t}\left[\frac{e^{r\delta_t}f_u - df_u}{u-d} + \frac{uf_d - e^{r\delta_t}f_d}{u-d}\right]
\end{align*}

\begin{equation} \label{eq:v_price_complete}
    \therefore \mathcal{V} = e^{-r\delta_t}\left[f_u \frac{e^{r\delta_t} - d}{u - d} + f_d \frac{u - e^{r\delta_t}}{u-d}\right]
\end{equation}

$\mathcal{V}$ is the arbitrage-free price for this derivative. Consider any other price $\mathcal{P} < \mathcal{V}$. Buying the portfolio $\mathcal{P}$ and selling $\mathcal{V}$ at $t=0$ guarantees, at $t=\delta_t$, enough money to settle and earn $\mathcal{V}-\mathcal{P}$ risk-free. The same argument can be done for a value $\mathcal{P} > \mathcal{V}$.\\

What, then, would have happened, had we decided to replicate this payoff using only the bank account and the probabilities $p$ and $1-p$? Accordingly, we would've price the derivative as the present value of the expected payoff under the $\mathbb{P}$ measure. Denote $\hat{\mathcal{V}}$ this alternate value, then:

\begin{equation}
    \hat{\mathcal{V}} = \exp(-r\delta_t)\mathbb{E}[f] = \exp(-r\delta_t)[f_u \cdot p + f_d \cdot (1- p) ]
\end{equation}\\


Pricing $\hat{\mathcal{V}}$ for $f$ does not guarantee $\hat{\mathcal{V}} = \mathcal{V}$, which could lead to arbitrage otherwise. Assuming $\hat{\mathcal{V}} \neq \mathcal{V}$, the expected payoff of $f$ would not be $\hat{\mathcal{V}}$, investors would be inclined to make a profit, thereby breaking the assumption that every position taken on the derivative is independent of one another; we cannot expect to break even in the long run.


\subsection{The \Bbb Q measure}
Comming back to our arbitrage-free price 

\begin{equation*}
    \mathcal{V} = e^{-r\delta_t}\left[f_u \frac{e^{r\delta_t} - d}{u - d} + f_d \frac{u - e^{r\delta_t}}{u-d}\right]
\end{equation*}

Denote
\begin{equation}
    q:= \frac{\exp{r\delta_t} - d}{u - d} \Longrightarrow 1-q = \frac{u - \exp{(r\delta_t)}}{u-d}
\end{equation}\\

We can argue that $d < \exp{(r\delta_t)} < u$ implies no arbitrage. To see why, 
\begin{enumerate}
\item Suppose $\exp{(r\delta_t)} < d < u$.\\
    At t=0 we can borrow $\$S_0$ and buy the stock. At $t=1$, we collect either $S_0u$ or $S_0d$, thereby making a risk-free profit of $S_0(u - \exp{(r\delta_t)})$ or $S_0(d - \exp{(r\delta_t)})$

\item Suppose $d < u < \exp{(r\delta_t)}$\\
    At $t=0$, lend $\$S_0$ and short the stock. At $t=1$, collect $\S_0\exp{(r\delta_t)}$ and buy the stock at either $S_0u$ or $S_0d$. Again, this guarantees a risk-free profit of either $S_0(\exp{(r\delta_t)} - u)$ or $S_0(\exp{(r\delta_t)} - d)$
\end{enumerate}

Being $d < \exp{(r\delta_t)} < u$ implies $0 < q < 1$. We can rewrite \ref{eq:v_price_complete} as

\begin{equation} \label{eq:v_price}
    \mathcal{V} = \exp{(-r\delta_t)}[S_0u\cdot q + S_0d \cdot (1-q)]
\end{equation}

$\mathcal V$ is the expectation under a measure probability $\mathbb Q$; it not the expected value of the derivative, but a change in the measure of our tree such that guarantees no arbitrage.


\section{$n$-period binomial tree model}
In order to generalize our model to $n$ periods we only need to consider each node as the root of another binomial tree. Consequently, we get a tree with $n$ periods and $2^n$ nodes at $t=n$.

\begin{center}
\begin{tikzpicture}
    % First Node
    \draw[-] (0,0) -- (0.5, 0.5)
    \draw[-] (0,0) -- (0.5, -0.5);
    \draw[black, fill=black](0.5,-0.5) circle (.3ex);
    \draw[black, fill=black](0.5,0.5) circle (.3ex); 
    \draw[black, fill=black](0,0) circle (.3ex);

    % 1) up node
    \draw[-](0.5, 0.5) -- (1, 1);
    \draw[-](0.5, 0.5) -- (1, 0);
    \draw[fill=black] (1,1) circle (.3ex);
    \draw[fill=black] (1,0) circle (.3ex);
    % 1) down node 
    \draw[-](0.5, -0.5) -- (1, 0);
    \draw[-](0.5, -0.5) -- (1, -1);
    \draw[fill=black] (1,-1) circle (.3ex);
    
    % Connection points
    \draw[black](1.3, 1) circle (.1ex);
    \draw[black](1.6, 1) circle (.1ex);
    \draw[black](1.9, 1) circle (.1ex);

    \draw[black](1.3, 0) circle (.1ex);
    \draw[black](1.6, 0) circle (.1ex);
    \draw[black](1.9, 0) circle (.1ex);


    \draw[black](1.3, -1) circle (.1ex);
    \draw[black](1.6, -1) circle (.1ex);
    \draw[black](1.9, -1) circle (.1ex);
    
    \draw[black](2.5, 0.3) circle (.1ex);
    \draw[black](2.5, 0) circle (.1ex);
    \draw[black](2.5, -0.3) circle (.1ex);

    % 2.1) up node
    \draw[-, red](2, 1) -- (2.5, 1.5);
    \draw[-, red](2, 1) -- (2.5, 0.5);
    \draw[red, fill=red] (2.5, 1.5) circle (.3ex);
    \draw[red, fill=red] (2.5,0.5) circle (.3ex);
    % 2.2) down node 
    \draw[-](2, -1) -- (2.5, -0.5);
    \draw[-](2, -1) -- (2.5, -1.5);
    \draw[fill=black] (2.5,-0.5) circle (.3ex);
    \draw[fill=black] (2.5,-1.5) circle (.3ex);

    \node[font=\fontsize{4}{4}] at (0, -2) {$0\delta_t$};
    \node[font=\fontsize{4}{4}] at (0.5, -2) {$1\delta_t$};
    \node[font=\fontsize{4}{4}] at (1, -2) {$2\delta_t$};
    \draw (1.32, -2) circle (.1ex);
    \draw (1.59, -2) circle (.1ex);
    \draw (1.86, -2) circle (.1ex);
    \node[font=\fontsize{4}{4}] at (2.5, -2) {$n\delta_t$};
\end{tikzpicture}
\end{center}

To motivate this generalized model, we will now present an example of a $4$-period binomial model.
% Find another name for this example...
\subsection{An example}
Suppose that, at $t=0$, we have a stock $S_0$ that can go up with by an up factor of $1.20$, or down by a factor of $0.80$. Assume further that the $\mathbb{P}$ measure probability for an up move is $\frac{3}{4}$. Being consistent with the notation used, $u=1.20$, $d=0.80$, $p = \frac{3}{4}$ and $ 1 - p = \frac{1}{4}$. What we want is to price is a call option on $S_0$ with strike price $k=100$.Denote this claim at $t=4$ $f$, we can represent this claim as:

\begin{equation}
    f = [S_n - k]^+
\end{equation}

Where $S_n$ represents the value of $S$ at maturity, that is, when the option must be payed.

\begin{center}
\begin{tikzpicture}
    \node (s) at (0,0) {$100$};

    \node[above right = 0.3cm of s] (su) {$120$}; \draw (s) -- (su);
    \node[below right = 0.3cm of s] (sd) {$80$}; \draw (s) -- (sd);
\end{tikzpicture}
\end{center}

\end{document}
